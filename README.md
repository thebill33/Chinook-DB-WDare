# Chinook Music Sales - SQL Portfolio Analysis

**Author:** William Dare<br>
**Tools Used:** SQL, Google Colab, PostgreSQL

---

## Project Overview

This project analyzes the Chinook Music Sales Database using SQL. It was created as my first portfolio project to demonstrate fundamental SQL skills by answering real-world business questions.

The analysis uses standard SQL concepts such as:
- SELECT statements and filtering
- INNER JOINs across multiple tables
- Aggregations with GROUP BY and ORDER BY
- Subqueries and nested logic
- Window functions
- Common Table Expressions (CTEs)

---

## Goals

- Strengthen SQL proficiency through practical analysis
- Answer key business-related questions using a normalized relational database
- Present clean, readable SQL code with clear takeaways

---

## Database Information

The [Chinook Database](https://github.com/lerocha/chinook-database) simulates a digital music store and contains:
- Customers and Employees
- Invoices and Invoice Line Items
- Artists, Albums, Tracks, and Genres

This project uses the **PostgreSQL** version of Chinook and was run in **Supabase** with a PostgreSQL connection.

---

## Questions Answered

- What are the top 5 music genres by total sales in the USA?
- Which customer made the highest purchase in each country?
- How many customers are in each country and what is the average spend per country?
- What is the average invoice total over time?(Monthly)
-  What is each track's sales rank within its album?
- Are there customers that haven't purchased anything in 6 months?
- What is the tier of customers based on customer sales.
- What is the trend of revenue on a month over month basis?
- What is the percentage of total revenue generated by the Top 10% of customers based on sales?

---

## Results and Takeaways

### 1. What are the top 5 music genres in total sales in the USA?



```
SELECT g.name, SUM(i.total) AS total_sales
FROM genre g
  JOIN track t ON g.genre_id = t.genre_id
  JOIN invoice_line il ON t.track_id = il.track_id
  JOIN invoice i ON il.invoice_id = i.invoice_id
WHERE i.billing_country = 'USA'
GROUP BY g.name
ORDER BY total_sales DESC
LIMIT 5
```


| name               | total_sales |
| ------------------ | ----------- |
| Rock               | 1526.14     |
| Latin              | 754.67      |
| Metal              | 554.45      |
| Alternative & Punk | 415.92      |
| Jazz               | 202.95      |

According to the data, it shows that Rock has the highest total sales of all music genres in the USA, followed by Latin, Metal, Alternative & Punk, and Jazz.  With Metal and Alternative & Punk being subgenres of Rock, this suggests that majority of customers prefer rock and its subgenres over others.

### 2. Which customer made the biggest purchase per country?




```
WITH rank_table AS(
    SELECT DISTINCT c.first_name AS first, c.last_name AS last, c.country AS country, MAX(i.total) AS max_total, RANK() OVER (PARTITION BY c.country ORDER BY MAX(i.total) DESC) AS max_rank
    FROM customer c
    JOIN invoice i ON c.customer_id = i.customer_id
    GROUP BY c.first_name, c.last_name, c.country
    ORDER BY c.country, max_total DESC
)

SELECT first, last, country, max_total
FROM rank_table
WHERE max_rank = 1
ORDER BY country
```
| first     | last         | country        | max_total |
| --------- | ------------ | -------------- | --------- |
| Diego     | Gutiérrez    | Argentina      | 13.86     |
| Mark      | Taylor       | Australia      | 13.86     |
| Astrid    | Gruber       | Austria        | 18.86     |
| Daan      | Peeters      | Belgium        | 13.86     |
| Alexandre | Rocha        | Brazil         | 13.86     |
| Eduardo   | Martins      | Brazil         | 13.86     |
| Fernanda  | Ramos        | Brazil         | 13.86     |
| Luís      | Gonçalves    | Brazil         | 13.86     |
| Roberto   | Almeida      | Brazil         | 13.86     |
| Aaron     | Mitchell     | Canada         | 13.86     |
| Edward    | Francis      | Canada         | 13.86     |
| Ellie     | Sullivan     | Canada         | 13.86     |
| François  | Tremblay     | Canada         | 13.86     |
| Jennifer  | Peterson     | Canada         | 13.86     |
| Mark      | Philips      | Canada         | 13.86     |
| Martha    | Silk         | Canada         | 13.86     |
| Robert    | Brown        | Canada         | 13.86     |
| Luis      | Rojas        | Chile          | 17.91     |
| Helena    | Holý         | Czech Republic | 25.86     |
| Kara      | Nielsen      | Denmark        | 13.86     |
| Terhi     | Hämäläinen   | Finland        | 13.86     |
| Isabelle  | Mercier      | France         | 16.86     |
| Fynn      | Zimmermann   | Germany        | 14.91     |
| Ladislav  | Kovács       | Hungary        | 21.86     |
| Manoj     | Pareek       | India          | 13.86     |
| Puja      | Srivastava   | India          | 13.86     |
| Hugh      | O'Reilly     | Ireland        | 21.86     |
| Lucas     | Mancini      | Italy          | 13.86     |
| Johannes  | Van der Berg | Netherlands    | 13.86     |
| Bjørn     | Hansen       | Norway         | 15.86     |
| Stanisław | Wójcik       | Poland         | 13.86     |
| João      | Fernandes    | Portugal       | 13.86     |
| Madalena  | Sampaio      | Portugal       | 13.86     |
| Enrique   | Muñoz        | Spain          | 13.86     |
| Joakim    | Johansson    | Sweden         | 13.86     |
| Emma      | Jones        | United Kingdom | 13.86     |
| Phil      | Hughes       | United Kingdom | 13.86     |
| Steve     | Murray       | United Kingdom | 13.86     |
| Richard   | Cunningham   | USA            | 23.86     |

The table above shows who made the biggest purchase per country.  Some countries have multiple customers that made purchases totalling the same amount, such as the UK, Brazil, and Canada.

### 3. How many customers are in each country and what is the average spend per country?


```
SELECT COUNT(DISTINCT c.customer_id) AS cust_count, c.country, ROUND(AVG(i.total),2) AS average
FROM customer c
JOIN invoice i ON c.customer_id = i.customer_id
GROUP BY c.country
ORDER BY cust_count DESC, ROUND(AVG(i.total),2) DESC
```

| cust_count | country        | average |
| ---------- | -------------- | ------- |
| 13         | USA            | 5.75    |
| 8          | Canada         | 5.43    |
| 5          | France         | 5.57    |
| 5          | Brazil         | 5.43    |
| 4          | Germany        | 5.59    |
| 3          | United Kingdom | 5.37    |
| 2          | Czech Republic | 6.45    |
| 2          | India          | 5.79    |
| 2          | Portugal       | 5.52    |
| 1          | Chile          | 6.66    |
| 1          | Hungary        | 6.52    |
| 1          | Ireland        | 6.52    |
| 1          | Austria        | 6.09    |
| 1          | Finland        | 5.95    |
| 1          | Netherlands    | 5.80    |
| 1          | Norway         | 5.66    |
| 1          | Sweden         | 5.52    |
| 1          | Belgium        | 5.37    |
| 1          | Spain          | 5.37    |
| 1          | Poland         | 5.37    |
| 1          | Denmark        | 5.37    |
| 1          | Australia      | 5.37    |
| 1          | Italy          | 5.37    |
| 1          | Argentina      | 5.37    |

The table above shows the number of customers and the average purchase amount of each country.  According to the data, majority if the customers reside in the USA and Canada.  Chile has the highest average with 6.66, but it only has 1 customer driving that average.

### 4. What is the average invoice total over time?(Monthly)


```
SELECT DATE_TRUNC('month', invoice_date) AS month, ROUND(AVG(total),2) AS month_avg
FROM invoice
GROUP BY DATE_TRUNC('month', invoice_date)
ORDER BY DATE_TRUNC('month', invoice_date)
```
| month               | month_avg |
| ------------------- | --------- |
| 2021-01-01 00:00:00 | 5.94      |
| 2021-02-01 00:00:00 | 5.37      |
| 2021-03-01 00:00:00 | 5.37      |
| 2021-04-01 00:00:00 | 5.37      |
| 2021-05-01 00:00:00 | 5.37      |
| 2021-06-01 00:00:00 | 5.37      |
| 2021-07-01 00:00:00 | 5.37      |
| 2021-08-01 00:00:00 | 5.37      |
| 2021-09-01 00:00:00 | 5.37      |
| 2021-10-01 00:00:00 | 5.37      |
| 2021-11-01 00:00:00 | 5.37      |
| 2021-12-01 00:00:00 | 5.37      |
| 2022-01-01 00:00:00 | 7.52      |
| 2022-02-01 00:00:00 | 6.66      |
| 2022-03-01 00:00:00 | 6.37      |
| 2022-04-01 00:00:00 | 5.37      |
| 2022-05-01 00:00:00 | 5.37      |
| 2022-06-01 00:00:00 | 5.37      |
| 2022-07-01 00:00:00 | 5.37      |
| 2022-08-01 00:00:00 | 5.37      |
| 2022-09-01 00:00:00 | 6.11      |
| 2022-10-01 00:00:00 | 5.37      |
| 2022-11-01 00:00:00 | 5.37      |
| 2022-12-01 00:00:00 | 5.37      |
| 2023-01-01 00:00:00 | 5.37      |
| 2023-02-01 00:00:00 | 5.37      |
| 2023-03-01 00:00:00 | 5.37      |
| 2023-04-01 00:00:00 | 7.37      |
| 2023-05-01 00:00:00 | 6.09      |
| 2023-06-01 00:00:00 | 7.23      |
| 2023-07-01 00:00:00 | 5.37      |
| 2023-08-01 00:00:00 | 5.37      |
| 2023-09-01 00:00:00 | 5.37      |
| 2023-10-01 00:00:00 | 5.37      |
| 2023-11-01 00:00:00 | 3.96      |
| 2023-12-01 00:00:00 | 5.37      |
| 2024-01-01 00:00:00 | 5.37      |
| 2024-02-01 00:00:00 | 5.37      |
| 2024-03-01 00:00:00 | 5.37      |
| 2024-04-01 00:00:00 | 5.37      |
| 2024-05-01 00:00:00 | 5.37      |
| 2024-06-01 00:00:00 | 5.37      |
| 2024-07-01 00:00:00 | 5.66      |
| 2024-08-01 00:00:00 | 6.80      |
| 2024-09-01 00:00:00 | 7.79      |
| 2024-10-01 00:00:00 | 6.09      |
| 2024-11-01 00:00:00 | 5.37      |
| 2024-12-01 00:00:00 | 5.37      |
| 2025-01-01 00:00:00 | 5.37      |
| 2025-02-01 00:00:00 | 5.54      |
| 2025-03-01 00:00:00 | 5.37      |
| 2025-04-01 00:00:00 | 6.73      |
| 2025-05-01 00:00:00 | 5.37      |
| 2025-06-01 00:00:00 | 5.37      |
| 2025-07-01 00:00:00 | 5.37      |
| 2025-08-01 00:00:00 | 5.37      |
| 2025-09-01 00:00:00 | 5.37      |
| 2025-10-01 00:00:00 | 5.37      |
| 2025-11-01 00:00:00 | 7.09      |
| 2025-12-01 00:00:00 | 5.52      |

The table above shows the average monthly sales.  The highest average occurred for the month of September 2024 with an average of 7.79.

### 5.  What is each track's sales rank within its album?


```
SELECT t.name AS track, al.title AS album, ar.name AS artist, SUM(i.total) AS sales, RANK() OVER (PARTITION BY al.title ORDER BY SUM(i.total) DESC) AS album_sales_rank
FROM invoice i
JOIN invoice_line il ON i.invoice_id = il.invoice_id
JOIN track t ON il.track_id = t.track_id
JOIN album al ON t.album_id = al.album_id
JOIN artist ar ON al.artist_id = ar.artist_id
GROUP BY t.name, al.title, ar.name
ORDER BY ar.name, al.title, SUM(i.total)
DESC
```
| track                                                                                                         | album                                                                                           | artist                                                                                | sales | album_sales_rank |
| ------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- | ----- | ---------------- |
| Requiem, Op.48: 4. Pie Jesu                                                                                   | Fauré: Requiem, Ravel: Pavane & Others                                                          | Academy of St. Martin in the Fields, John Birch, Sir Neville Marriner & Sylvia McNair | 15.86 | 1                |
| Fantasia On Greensleeves                                                                                      | The World of Classical Favourites                                                               | Academy of St. Martin in the Fields & Sir Neville Marriner                            | 1.98  | 1                |
| Suite No. 3 in D, BWV 1068: III. Gavotte I & II                                                               | Bach: Orchestral Suites Nos. 1 - 4                                                              | Academy of St. Martin in the Fields, Sir Neville Marriner & Thurston Dart             | 10.89 | 1                |
| Balls to the Wall                                                                                             | Balls to the Wall                                                                               | Accept                                                                                | 10.89 | 1                |
| Fast As a Shark                                                                                               | Restless and Wild                                                                               | Accept                                                                                | 8.91  | 1                |
| Princess of the Dawn                                                                                          | Restless and Wild                                                                               | Accept                                                                                | 5.94  | 2                |
| Restless and Wild                                                                                             | Restless and Wild                                                                               | Accept                                                                                | 1.98  | 3                |
| Snowballed                                                                                                    | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 14.85 | 1                |
| Inject The Venom                                                                                              | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 12.87 | 2                |
| Spellbound                                                                                                    | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 8.91  | 3                |
| For Those About To Rock (We Salute You)                                                                       | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 5.94  | 4                |
| Night Of The Long Knives                                                                                      | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 5.94  | 4                |
| Put The Finger On You                                                                                         | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 3.96  | 6                |
| Breaking The Rules                                                                                            | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 3.96  | 6                |
| Evil Walks                                                                                                    | For Those About To Rock We Salute You                                                           | AC/DC                                                                                 | 3.96  | 6                |
| Overdose                                                                                                      | Let There Be Rock                                                                               | AC/DC                                                                                 | 14.85 | 1                |
| Go Down                                                                                                       | Let There Be Rock                                                                               | AC/DC                                                                                 | 8.91  | 2                |
| Problem Child                                                                                                 | Let There Be Rock                                                                               | AC/DC                                                                                 | 8.91  | 2                |
| Hell Ain't A Bad Place To Be                                                                                  | Let There Be Rock                                                                               | AC/DC                                                                                 | 8.91  | 2                |
| Dog Eat Dog                                                                                                   | Let There Be Rock                                                                               | AC/DC                                                                                 | 5.94  | 5                |
| Symphony No. 3 Op. 36 for Orchestra and Soprano "Symfonia Piesni Zalosnych" \ Lento E Largo - Tranquillissimo | Górecki: Symphony No. 3                                                                         | Adrian Leaper & Doreen de Feis                                                        | 5.94  | 1                |
| Deuces Are Wild                                                                                               | Big Ones                                                                                        | Aerosmith                                                                             | 14.85 | 1                |
| Amazing                                                                                                       | Big Ones                                                                                        | Aerosmith                                                                             | 13.86 | 2                |
| Blind Man                                                                                                     | Big Ones                                                                                        | Aerosmith                                                                             | 8.91  | 3                |
| Rag Doll                                                                                                      | Big Ones                                                                                        | Aerosmith                                                                             | 8.91  | 3                |
| What It Takes                                                                                                 | Big Ones                                                                                        | Aerosmith                                                                             | 8.91  | 3                |
| Livin' On The Edge                                                                                            | Big Ones                                                                                        | Aerosmith                                                                             | 8.91  | 3                |
| Janie's Got A Gun                                                                                             | Big Ones                                                                                        | Aerosmith                                                                             | 5.94  | 7                |
| Love In An Elevator                                                                                           | Big Ones                                                                                        | Aerosmith                                                                             | 5.94  | 7                |
| Angel                                                                                                         | Big Ones                                                                                        | Aerosmith                                                                             | 5.94  | 7                |
| Not The Doctor                                                                                                | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 22.77 | 1                |
| You Oughta Know                                                                                               | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 13.86 | 2                |
| Forgiven                                                                                                      | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 8.91  | 3                |
| Wake Up                                                                                                       | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 8.91  | 3                |
| Right Through You                                                                                             | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 8.91  | 3                |
| You Learn                                                                                                     | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 8.91  | 3                |
| All I Really Want                                                                                             | Jagged Little Pill                                                                              | Alanis Morissette                                                                     | 8.91  | 3                |
| Sea Of Sorrow                                                                                                 | Facelift                                                                                        | Alice In Chains                                                                       | 13.86 | 1                |
| It Ain't Like That                                                                                            | Facelift                                                                                        | Alice In Chains                                                                       | 13.86 | 1                |
| Real Thing                                                                                                    | Facelift                                                                                        | Alice In Chains                                                                       | 13.86 | 1                |
| Confusion                                                                                                     | Facelift                                                                                        | Alice In Chains                                                                       | 8.91  | 4                |
| I Can't Remember                                                                                              | Facelift                                                                                        | Alice In Chains                                                                       | 8.91  | 4                |
| I Know Somethin (Bout You)                                                                                    | Facelift                                                                                        | Alice In Chains                                                                       | 8.91  | 4                |
| Bleed The Freak                                                                                               | Facelift                                                                                        | Alice In Chains                                                                       | 8.91  | 4                |
| Rehab                                                                                                         | Back to Black                                                                                   | Amy Winehouse                                                                         | 16.85 | 1                |
| He Can Only Hold Her                                                                                          | Back to Black                                                                                   | Amy Winehouse                                                                         | 15.86 | 2                |
| Just Friends                                                                                                  | Back to Black                                                                                   | Amy Winehouse                                                                         | 5.94  | 3                |
| Wake Up Alone                                                                                                 | Back to Black                                                                                   | Amy Winehouse                                                                         | 5.94  | 3                |
| Rehab (Hot Chip Remix)                                                                                        | Back to Black                                                                                   | Amy Winehouse                                                                         | 5.94  | 3                |
| You Know I'm No Good (feat. Ghostface Killah)                                                                 | Back to Black                                                                                   | Amy Winehouse                                                                         | 3.96  | 6                |
| Some Unholy War                                                                                               | Back to Black                                                                                   | Amy Winehouse                                                                         | 3.96  | 6                |
| Me & Mr. Jones                                                                                                | Back to Black                                                                                   | Amy Winehouse                                                                         | 1.98  | 8                |
| Tears Dry On Their Own                                                                                        | Back to Black                                                                                   | Amy Winehouse                                                                         | 1.98  | 8                |
| Back to Black                                                                                                 | Back to Black                                                                                   | Amy Winehouse                                                                         | 1.98  | 8                |
| You Know I'm No Good                                                                                          | Back to Black                                                                                   | Amy Winehouse                                                                         | 1.98  | 8                |
| Help Yourself                                                                                                 | Frank                                                                                           | Amy Winehouse                                                                         | 8.91  | 1                |
| I Heard Love Is Blind                                                                                         | Frank                                                                                           | Amy Winehouse                                                                         | 5.94  | 2                |
| Amy Amy Amy (Outro)                                                                                           | Frank                                                                                           | Amy Winehouse                                                                         | 5.94  | 2                |
| Take the Box                                                                                                  | Frank                                                                                           | Amy Winehouse                                                                         | 5.94  | 2                |
| Intro / Stronger Than Me                                                                                      | Frank                                                                                           | Amy Winehouse                                                                         | 3.96  | 5                |
| F**k Me Pumps                                                                                                 | Frank                                                                                           | Amy Winehouse                                                                         | 3.96  | 5                |
| Wellington's Victory or the Battle Symphony, Op.91: 2. Symphony of Triumph                                    | Tchaikovsky: 1812 Festival Overture, Op.49, Capriccio Italien & Beethoven: Wellington's Victory | Antal Doráti & London Symphony Orchestra                                              | 3.96  | 1                |
| Bumbo Da Mangueira                                                                                            | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 17.82 | 1                |
| Só Tinha De Ser Com Você                                                                                      | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 17.82 | 1                |
| Tanto Tempo                                                                                                   | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 15.84 | 3                |
| Tarde Em Itapoã                                                                                               | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 14.85 | 4                |
| Um Jantar Pra Dois                                                                                            | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 13.86 | 5                |
| Only A Dream In Rio                                                                                           | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 13.86 | 5                |
| Momentos Que Marcam                                                                                           | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 3.96  | 7                |
| Santo Antonio                                                                                                 | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 3.96  | 7                |
| Linha Do Horizonte                                                                                            | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 1.98  | 9                |
| Eu Vim Da Bahia - Live                                                                                        | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 1.98  | 9                |
| Abrir A Porta                                                                                                 | Chill: Brazil (Disc 2)                                                                          | Antônio Carlos Jobim                                                                  | 1.98  | 9                |
| Por Causa De Você                                                                                             | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 22.77 | 1                |
| Falando De Amor                                                                                               | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 13.86 | 2                |
| O Boto (Bôto)                                                                                                 | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 13.86 | 2                |
| Canta, Canta Mais                                                                                             | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 13.86 | 2                |
| Angela                                                                                                        | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 8.91  | 5                |
| Ligia                                                                                                         | Warner 25 Anos                                                                                  | Antônio Carlos Jobim                                                                  | 8.91  | 5                |
| Welcome Home (Sanitarium)                                                                                     | Plays Metallica By Four Cellos                                                                  | Apocalyptica                                                                          | 22.77 | 1                |
| The Unforgiven                                                                                                | Plays Metallica By Four Cellos                                                                  | Apocalyptica                                                                          | 13.86 | 2                |
| Master Of Puppets                                                                                             | Plays Metallica By Four Cellos                                                                  | Apocalyptica                                                                          | 8.91  | 3                |
| Pilot                                                                                                         | Aquaman                                                                                         | Aquaman                                                                               | 14.89 | 1                |
| Hypnotize                                                                                                     | Audioslave                                                                                      | Audioslave                                                                            | 13.86 | 1                |
| The Last Remaining Light                                                                                      | Audioslave                                                                                      | Audioslave                                                                            | 13.86 | 1                |
| Cochise                                                                                                       | Audioslave                                                                                      | Audioslave                                                                            | 13.86 | 1                |
| Like a Stone                                                                                                  | Audioslave                                                                                      | Audioslave                                                                            | 13.86 | 1                |
| Exploder                                                                                                      | Audioslave                                                                                      | Audioslave                                                                            | 13.86 | 1                |
| Set It Off                                                                                                    | Audioslave                                                                                      | Audioslave                                                                            | 8.91  | 6                |
| Yesterday To Tomorrow                                                                                         | Out Of Exile                                                                                    | Audioslave                                                                            | 13.86 | 1                |
| Dandelion                                                                                                     | Out Of Exile                                                                                    | Audioslave                                                                            | 13.86 | 1                |
| Drown Me Slowly                                                                                               | Out Of Exile                                                                                    | Audioslave                                                                            | 13.86 | 1                |
| Doesn't Remind Me                                                                                             | Out Of Exile                                                                                    | Audioslave                                                                            | 13.86 | 1                |
| Your Time Has Come                                                                                            | Out Of Exile                                                                                    | Audioslave                                                                            | 13.86 | 1                |
| Sound of a Gun                                                                                                | Revelations                                                                                     | Audioslave                                                                            | 16.86 | 1                |
| Moth                                                                                                          | Revelations                                                                                     | Audioslave                                                                            | 16.86 | 1                |
| Show Me How to Live (Live at the Quart Festival)                                                              | Revelations                                                                                     | Audioslave                                                                            | 15.86 | 3                |
| Shape of Things to Come                                                                                       | Revelations                                                                                     | Audioslave                                                                            | 15.86 | 3                |
| Until We Fall                                                                                                 | Revelations                                                                                     | Audioslave                                                                            | 15.86 | 3                |
| Good Golly Miss Molly                                                                                         | BackBeat Soundtrack                                                                             | BackBeat                                                                              | 13.86 | 1                |

The table above shows the track list of each album and its rank according to total sales per track on each album.  Better analysis could be done by filtering to certain artists with higher sales.

### 6. Are there customers who haven't purchased anything in 6 months?


```
SELECT DISTINCT i.customer_id, c.first_name, c.last_name
FROM invoice i
JOIN customer c ON i.customer_id = c.customer_id
WHERE i.customer_id NOT IN(
    SELECT customer_id FROM invoice
    WHERE invoice_date >= NOW() - INTERVAL '6 months'
    AND invoice_date <= NOW()
)
ORDER BY i.customer_id
```

| customer_id | first_name | last_name    |
| ----------- | ---------- | ------------ |
| 2           | Leonie     | Köhler       |
| 4           | Bjørn      | Hansen       |
| 6           | Helena     | Holý         |
| 7           | Astrid     | Gruber       |
| 8           | Daan       | Peeters      |
| 10          | Eduardo    | Martins      |
| 13          | Fernanda   | Ramos        |
| 17          | Jack       | Smith        |
| 19          | Tim        | Goyer        |
| 21          | Kathy      | Chase        |
| 22          | Heather    | Leacock      |
| 23          | John       | Gordon       |
| 25          | Victor     | Stevens      |
| 27          | Patrick    | Gray         |
| 29          | Robert     | Brown        |
| 31          | Martha     | Silk         |
| 34          | João       | Fernandes    |
| 36          | Hannah     | Schneider    |
| 38          | Niklas     | Schröder     |
| 40          | Dominique  | Lefebvre     |
| 42          | Wyatt      | Girard       |
| 43          | Isabelle   | Mercier      |
| 44          | Terhi      | Hämäläinen   |
| 46          | Hugh       | O'Reilly     |
| 48          | Johannes   | Van der Berg |
| 55          | Mark       | Taylor       |
| 57          | Luis       | Rojas        |
| 59          | Puja       | Srivastava   |

The table above shows all the customer that have not made a purchase in the last 6 months from today's date.  There were 28 customers who have not made a purchase.  This suggests that at this time with 59 total customers, roughly half are accounting for the total revenue.

### 7.  How can customers be separated into tiers based on the total sales?


```
WITH rank_table AS (
  SELECT i.customer_id AS id, c.first_name AS first, c.last_name AS last, SUM(i.total) AS sales_total, DENSE_RANK() OVER (ORDER BY SUM(i.total) DESC) AS sales_rank
FROM invoice i
JOIN customer c ON i.customer_id = c.customer_id
GROUP BY i.customer_id, c.first_name, c.last_name
ORDER BY SUM(i.total) DESC
)

SELECT id, first, last, sales_total, sales_rank, (
  CASE WHEN sales_rank <= 4 THEN 'High'
  WHEN sales_rank > 4 AND sales_rank < 9 THEN 'Middle'
  ELSE 'Low' END
) AS sales_tier
FROM rank_table
```

| id | first     | last         | sales_total | sales_rank | sales_tier |
| -- | --------- | ------------ | ----------- | ---------- | ---------- |
| 6  | Helena    | Holý         | 49.62       | 1          | High       |
| 26 | Richard   | Cunningham   | 47.62       | 2          | High       |
| 57 | Luis      | Rojas        | 46.62       | 3          | High       |
| 45 | Ladislav  | Kovács       | 45.62       | 4          | High       |
| 46 | Hugh      | O'Reilly     | 45.62       | 4          | High       |
| 37 | Fynn      | Zimmermann   | 43.62       | 5          | Middle     |
| 24 | Frank     | Ralston      | 43.62       | 5          | Middle     |
| 28 | Julia     | Barnett      | 43.62       | 5          | Middle     |
| 7  | Astrid    | Gruber       | 42.62       | 6          | Middle     |
| 25 | Victor    | Stevens      | 42.62       | 6          | Middle     |
| 44 | Terhi     | Hämäläinen   | 41.62       | 7          | Middle     |
| 43 | Isabelle  | Mercier      | 40.62       | 8          | Middle     |
| 5  | František | Wichterlová  | 40.62       | 8          | Middle     |
| 48 | Johannes  | Van der Berg | 40.62       | 8          | Middle     |
| 17 | Jack      | Smith        | 39.62       | 9          | Low        |
| 1  | Luís      | Gonçalves    | 39.62       | 9          | Low        |
| 22 | Heather   | Leacock      | 39.62       | 9          | Low        |
| 34 | João      | Fernandes    | 39.62       | 9          | Low        |
| 4  | Bjørn     | Hansen       | 39.62       | 9          | Low        |
| 20 | Dan       | Miller       | 39.62       | 9          | Low        |
| 3  | François  | Tremblay     | 39.62       | 9          | Low        |
| 42 | Wyatt     | Girard       | 39.62       | 9          | Low        |
| 19 | Tim       | Goyer        | 38.62       | 10         | Low        |
| 15 | Jennifer  | Peterson     | 38.62       | 10         | Low        |
| 40 | Dominique | Lefebvre     | 38.62       | 10         | Low        |
| 51 | Joakim    | Johansson    | 38.62       | 10         | Low        |
| 58 | Manoj     | Pareek       | 38.62       | 10         | Low        |
| 39 | Camille   | Bernard      | 38.62       | 10         | Low        |
| 23 | John      | Gordon       | 37.62       | 11         | Low        |
| 30 | Edward    | Francis      | 37.62       | 11         | Low        |
| 18 | Michelle  | Brooks       | 37.62       | 11         | Low        |
| 50 | Enrique   | Muñoz        | 37.62       | 11         | Low        |
| 36 | Hannah    | Schneider    | 37.62       | 11         | Low        |
| 55 | Mark      | Taylor       | 37.62       | 11         | Low        |
| 29 | Robert    | Brown        | 37.62       | 11         | Low        |
| 13 | Fernanda  | Ramos        | 37.62       | 11         | Low        |
| 31 | Martha    | Silk         | 37.62       | 11         | Low        |
| 49 | Stanisław | Wójcik       | 37.62       | 11         | Low        |
| 47 | Lucas     | Mancini      | 37.62       | 11         | Low        |
| 41 | Marc      | Dubois       | 37.62       | 11         | Low        |
| 53 | Phil      | Hughes       | 37.62       | 11         | Low        |
| 56 | Diego     | Gutiérrez    | 37.62       | 11         | Low        |
| 33 | Ellie     | Sullivan     | 37.62       | 11         | Low        |
| 10 | Eduardo   | Martins      | 37.62       | 11         | Low        |
| 54 | Steve     | Murray       | 37.62       | 11         | Low        |
| 27 | Patrick   | Gray         | 37.62       | 11         | Low        |
| 21 | Kathy     | Chase        | 37.62       | 11         | Low        |
| 32 | Aaron     | Mitchell     | 37.62       | 11         | Low        |
| 38 | Niklas    | Schröder     | 37.62       | 11         | Low        |
| 14 | Mark      | Philips      | 37.62       | 11         | Low        |
| 9  | Kara      | Nielsen      | 37.62       | 11         | Low        |
| 2  | Leonie    | Köhler       | 37.62       | 11         | Low        |
| 11 | Alexandre | Rocha        | 37.62       | 11         | Low        |
| 35 | Madalena  | Sampaio      | 37.62       | 11         | Low        |
| 52 | Emma      | Jones        | 37.62       | 11         | Low        |
| 12 | Roberto   | Almeida      | 37.62       | 11         | Low        |
| 8  | Daan      | Peeters      | 37.62       | 11         | Low        |
| 16 | Frank     | Harris       | 37.62       | 11         | Low        |
| 59 | Puja      | Srivastava   | 36.64       | 12         | Low        |

The table above shows a table categorizing customer based on whether they are a high, middle, or low purchaser.  These categories were based on their rank of total purchases made.  This suggests we currently have 5 customers in the 'High' tier.

### 8.  What is the trend of revenue on a month over month basis?


```
SELECT
DATE_TRUNC('month', invoice_date) AS month, SUM(total) AS sales,
COALESCE(LAG(SUM(total)) OVER (ORDER BY DATE_TRUNC('month', invoice_date)),0) AS prev_sales,
 COALESCE(ROUND(((SUM(total) - LAG(SUM(total)) OVER (ORDER BY DATE_TRUNC('month', invoice_date))) / LAG(SUM(total)) OVER (ORDER BY DATE_TRUNC('month', invoice_date))) * 100, 2)||'%', 'N/A') AS pct_change
FROM invoice
GROUP BY DATE_TRUNC('month', invoice_date)
```

| month               | sales | prev_sales | pct_change |
| ------------------- | ----- | ---------- | ---------- |
| 2021-01-01 00:00:00 | 35.64 | 0          | N/A        |
| 2021-02-01 00:00:00 | 37.62 | 35.64      | 5.56%      |
| 2021-03-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-04-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-05-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-06-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-07-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-08-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-09-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-10-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-11-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2021-12-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-01-01 00:00:00 | 52.62 | 37.62      | 39.87%     |
| 2022-02-01 00:00:00 | 46.62 | 52.62      | -11.40%    |
| 2022-03-01 00:00:00 | 44.62 | 46.62      | -4.29%     |
| 2022-04-01 00:00:00 | 37.62 | 44.62      | -15.69%    |
| 2022-05-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-06-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-07-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-08-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-09-01 00:00:00 | 36.63 | 37.62      | -2.63%     |
| 2022-10-01 00:00:00 | 37.62 | 36.63      | 2.70%      |
| 2022-11-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2022-12-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-01-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-02-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-03-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-04-01 00:00:00 | 51.62 | 37.62      | 37.21%     |
| 2023-05-01 00:00:00 | 42.62 | 51.62      | -17.44%    |
| 2023-06-01 00:00:00 | 50.62 | 42.62      | 18.77%     |
| 2023-07-01 00:00:00 | 37.62 | 50.62      | -25.68%    |
| 2023-08-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-09-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-10-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2023-11-01 00:00:00 | 23.76 | 37.62      | -36.84%    |
| 2023-12-01 00:00:00 | 37.62 | 23.76      | 58.33%     |
| 2024-01-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-02-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-03-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-04-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-05-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-06-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2024-07-01 00:00:00 | 39.62 | 37.62      | 5.32%      |
| 2024-08-01 00:00:00 | 47.62 | 39.62      | 20.19%     |
| 2024-09-01 00:00:00 | 46.71 | 47.62      | -1.91%     |
| 2024-10-01 00:00:00 | 42.62 | 46.71      | -8.76%     |
| 2024-11-01 00:00:00 | 37.62 | 42.62      | -11.73%    |
| 2024-12-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-01-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-02-01 00:00:00 | 27.72 | 37.62      | -26.32%    |
| 2025-03-01 00:00:00 | 37.62 | 27.72      | 35.71%     |
| 2025-04-01 00:00:00 | 33.66 | 37.62      | -10.53%    |
| 2025-05-01 00:00:00 | 37.62 | 33.66      | 11.76%     |
| 2025-06-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-07-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-08-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-09-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-10-01 00:00:00 | 37.62 | 37.62      | 0.00%      |
| 2025-11-01 00:00:00 | 49.62 | 37.62      | 31.90%     |
| 2025-12-01 00:00:00 | 38.62 | 49.62      | -22.17%    |

The table above shows the month over month trend of sales according to the data.  There are a lot of months without a change, so better analysis may be done with a year over year estimate.

### 9. What is the percentage of total revenue that is driven by the top 10% of customers based on sales?


```
WITH percentiles AS (
  SELECT i.customer_id AS id, c.first_name AS first, c.last_name AS last, SUM(i.total) AS sales_total, ROUND(PERCENT_RANK() OVER (ORDER BY SUM(i.total)) * 100) AS percentile
FROM invoice i
JOIN customer c ON i.customer_id = c.customer_id
GROUP BY i.customer_id, c.first_name, c.last_name
),

top_ten AS (
  SELECT id, percentile, sales_total
  FROM percentiles
  WHERE percentile > 90
)

SELECT SUM(tt.sales_total) AS top_ten, (SELECT SUM(i.total) FROM invoice i) AS revenue, ROUND(SUM(tt.sales_total) / (SELECT SUM(i.total) FROM invoice i), 3) * 100 || '%' AS percentage
FROM top_ten tt
```

| top_ten | revenue | percentage |
| ------- | ------- | ---------- |
| 235.10  | 2328.60 | 10.100%    |

The results show that the top 10% (or 90th and above percentile) of customers account for 10.10% of the total revenue.  This suggests that revenue may be more evenly distributed between all customers.

### 10. What were the total sales for each employee in 2024?

```
SELECT e.first_name, e.last_name, SUM(i.total) AS sales_2024
FROM invoice i
JOIN customer c ON i.customer_id = c.customer_id
JOIN employee e ON c.support_rep_id = e.employee_id
WHERE i.invoice_date >= '2024-01-01'
AND i.invoice_date < '2025-01-01'
GROUP BY e.first_name, e.last_name

```

| first_name | last_name | sales_2024 |
| ---------- | --------- | ---------- |
| Steve      | Johnson   | 133.73     |
| Jane       | Peacock   | 146.60     |
| Margaret   | Park      | 197.20     |

The data shows the total sales each sales employee had for 2024.  The results indicate Margaret Park has the most sales while Steve Johnson has the least.

---

## Next Steps & Improvements

- Refining my knowledge in querying best practices and structure to achieve results in a more efficient manner
- Building my knowledge in more functions and keywords within SQL to better display and analyze results
- Build my knowledge withing Python to further utilize SQL and improve data analysis skills

---

## Credits

- [Chinook Database](https://github.com/lerocha/chinook-database) by Lauro de Souza Ferreira Filho

---

## Contact

*Created by WDare*  
[LinkedIn](https://www.linkedin.com/in/williamdare33) | [GitHub](https://github.com/thebill33)

---



